<!--?xml version="1.0" encoding="utf-8" ?--><!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head>

  <script type="text/javascript" language="JavaScript">
    //<![CDATA[
    function reDo() {
      if (innerWidth != origWidth || innerHeight != origHeight)
        location.reload();
    }
    if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
      origWidth = innerWidth;
      origHeight = innerHeight;
      onresize = reDo;
    }
    onerror = null;
  //]]>
  </script>
  <style type="text/css">/*<![CDATA[*/

    < !-- div.WebHelpPopupMenu {
      position: absolute;
      left: 0px;
      top: 0px;
      z-index: 4;
      visibility: hidden;
    }

    p.WebHelpNavBar {
      text-align: right;
    }

    -->
  
/*]]>*/</style>

  <script type="text/javascript">//<![CDATA[

    gRootRelPath = "../../../..";
    gCommonRootRelPath = "../../../..";
    gTopicId = "8.2.2.5.1.0_14";
  
//]]></script>

  <script type="text/javascript" src="../../../../template/scripts/rh.min.js"></script>
  <script type="text/javascript" src="../../../../template/scripts/common.min.js"></script>
  <script type="text/javascript" src="../../../../template/scripts/topic.min.js"></script>
  <script type="text/javascript" src="../../../../template/scripts/topicwidgets.min.js"></script>
<script type="text/javascript" src="../../../../whxdata/projectsettings.js"></script>
  <link rel="stylesheet" type="text/css" href="../../../../template/styles/topic.min.css">
  <link rel="stylesheet" type="text/css" href="../../../../template/Charcoal_Grey/topicheader.css">
  <meta name="topic-status" content="Draft">

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>move_and_collide</title>
  <meta name="generator" content="Adobe RoboHelp 2022">
  <link rel="stylesheet" type="text/css" href="../../../../assets/css/default.css">
  <script src="../../../../assets/scripts/main_script.js" type="module"></script>
  <meta name="rh-authors" content="">
  <meta name="topic-comment" content="Reference page for the move_and_collide function">
  <meta name="rh-index-keywords" content="move_and_collide">
  <meta name="search-keywords" content="move_and_collide">
  <meta name="template" content="assets/masterpages/Manual_Keyword_Page.htt">
</head>

<body>
  <div class="topic-header rh-hide" id="rh-topic-header">
    <div class="logo">
    </div>
    <div class="nav">
      <div class="title" title="move_and_collide">
        <span>move_and_collide</span>
      </div>
      <div class="gotohome" title="Click here to see this page in full context">
        <a href="#" onclick="rh._.goToFullLayout()">Click here to see this page in full context</a>
      </div>
    </div>
  </div>
  <div class="topic-header-shadow rh-hide" id="rh-topic-header-shadow"></div>



  <h1><span data-field="title" data-format="default">move_and_collide</span></h1>
  <p>此函数将实例在 X 轴和 Y 轴上移动给定的距离，同时避开给定的对象或图块地图。</p>
  <p>它允许您的实例在导航坡度或小步骤时移动，否则它将无法移动。</p>
  <p>该函数返回一个 <a href="../../../GML_Overview/Arrays.htm"> 数组 </a>，其中包含与其发生碰撞的实例和图块地图的 ID。</p>
  <h3>对象参数</h3>
  <div data-conref="../../../../assets/snippets/Collisions_function_accepted_arguments.hts">
  <p>除了对象和实例之外，该函数还接受：</p>
  <ul class="colour">
    <li>特殊关键字 <b>all</b> 和 <b>other</b></li>
    <li><span data-keyref="Type_ID_Element_Tilemap"><a target="_blank" href="../../../../../GameMaker_Language/GML_Reference/Asset_Management/Rooms/Tile_Map_Layers/layer_tilemap_get_id.htm"> 平铺地图元素 ID</a></span></li>
    <li>包含对象、实例、图块地图和关键字 <strong>all</strong>/<strong>other</strong> 组合的数组</li>
  </ul>
  <p>传递数组允许您在一次调用中检查多个对象和 / 或图块地图的碰撞。</p>

</div>
  <h3>它是如何工作的？</h3>
  <p>该函数将逐步移动您的实例，在每个步骤 / 迭代中检查碰撞。<span class="inline2">obj</span> 参数是它应该避免的对象、实例或 <a href="../../Asset_Management/Rooms/Tile_Map_Layers/layer_tilemap_get_id.htm"> 图块地图 </a>，默认情况下，该函数分 4 步移动您的实例 (您可以使用 <span class="inline2">num_iterations</span> 参数进行更改)。</p>
  <p>在每一次迭代中，它都会按 <span class="inline2">point_distance(0, 0, dx, dy) / num_iterations</span> 像素向指定方向移动你的实例，然后检查是否有碰撞。如果 <span class="inline2">num_iterations</span> 是 4，而你想移动 <span class="inline2">(8, 0)</span>，&nbsp; 它将在检查碰撞之前，每次迭代将你的实例移动 2 像素。</p>
  <p>如果在迭代过程中发现了碰撞，它将尝试在垂直于<span class="inline2">dx, dy</span>的方向上移动你的实例，或者朝着可选的<span class="inline2">xoff, yoff</span>参数中给出的矢量移动，从而绕过它。</p>
  <p>如果在任何迭代中，函数在&nbsp;<span class="inline2">dx, dy</span>方向发现了碰撞，并且能够绕过它(无论是在垂直方向还是在<span class="inline2">xoff, yoff</span>方向)移动，在该其他方向的移动将被算作一次迭代。</p>
  <h3>速度限制</h3>
  <p>可选参数 <span class="inline2">max_x_move</span> 和 <span class="inline2">max_y_move</span> 允许您指定实例可以在 X 和 Y 轴上移动的最大距离。</p>
  <p>这可以避免跳台中的一个常见问题，即玩家落地时向下的速度(重力)与其水平速度相加，使其在一帧中走得更快。</p>
  <p class="note"><span data-conref="../../../../assets/snippets/Tag_note.hts"><span class="note">NOTE</span></span>&nbsp;该函数使用实例的精灵碰撞遮罩(sprite mask)来检查碰撞(详见<a href="../../../../The_Asset_Editors/Sprites.htm">The Sprite Editor</a>&nbsp;)。</p>
  <p>&nbsp;</p>
  <h4>语法:</h4>
  <p class="code"><span data-field="title" data-format="default">move_and_collide</span>(dx, dy, obj, [num_iterations], [xoff], [yoff], [max_x_move], [max_y_move]);</p>
  <table>
    <colgroup>
      <col>
      <col>
      <col>
    </colgroup>
    <tbody>
      <tr>
        <th>参数</th>
        <th>类型</th>
        <th>描述</th>
      </tr>
      <tr>
        <td>dx</td>
        <td><span data-keyref="Type_Real"><a target="_blank" href="../../../../../GameMaker_Language/GML_Overview/Data_Types.htm">Real</a></span></td>
        <td>试图沿X轴移动的距离</td>
      </tr>
      <tr>
        <td>dy</td>
        <td><span data-keyref="Type_Real"><a target="_blank" href="../../../../../GameMaker_Language/GML_Overview/Data_Types.htm">Real</a></span></td>
        <td>试图沿Y轴移动的距离</td>
      </tr>
      <tr>
        <td>obj</td>
        <td><span data-keyref="Collision_obj_type"><span data-keyref="Type_Asset_Object"><a target="_blank" href="../../../../../The_Asset_Editors/Objects.htm">Object Asset</a></span>&nbsp;or&nbsp;<span data-keyref="Type_ID_Instance"><a target="_blank" href="../../../../../GameMaker_Language/GML_Reference/Asset_Management/Instances/Instance_Variables/id.htm">Object Instance</a></span>&nbsp;or&nbsp;<span data-keyref="Type_ID_Element_Tilemap"><a target="_blank" href="../../../../../GameMaker_Language/GML_Reference/Asset_Management/Rooms/Tile_Map_Layers/layer_tilemap_get_id.htm">Tile Map Element ID</a></span>&nbsp;or&nbsp;<span data-keyref="Type_Array"><a target="_blank" href="../../../../../GameMaker_Language/GML_Overview/Arrays.htm">Array</a></span></span></td>
        <td><span data-keyref="Collision_obj_description"> 对象、实例、图块地图 ID、所有 / 其他关键字或包含这些项目的数组 </span></td>
      </tr>
      <tr>
        <td>num_iterations</td>
        <td><span data-keyref="Type_Real"><a target="_blank" href="../../../../../GameMaker_Language/GML_Overview/Data_Types.htm">Real</a></span></td>
        <td><span data-conref="../../../../assets/snippets/Tag_optional.hts"><span class="optional">可选</span></span>&nbsp;的步数，例如，如果<span class="inline2">(dx, dy)</span>是<span class="inline2">(10, 0)</span>，步数是5，那么每次迭代时，在检查碰撞之前，实例将移动10/5=2像素。默认值是4。</td>
      </tr>
      <tr>
        <td>xoff</td>
        <td><span data-keyref="Type_Real"><a target="_blank" href="../../../../../GameMaker_Language/GML_Overview/Data_Types.htm">Real</a></span></td>
        <td><span data-conref="../../../../assets/snippets/Tag_optional.hts"><span class="optional">可选</span></span>&nbsp;碰撞时移动方向的 X 分量指定 0 将使用默认行为 (垂直移动方向)</td>
      </tr>
      <tr>
        <td>yoff</td>
        <td><span data-keyref="Type_Real"><a target="_blank" href="../../../../../GameMaker_Language/GML_Overview/Data_Types.htm">Real</a></span></td>
        <td><span data-conref="../../../../assets/snippets/Tag_optional.hts"><span class="optional">可选</span></span>&nbsp;碰撞时移动方向的 Y 分量指定 0 将使用默认行为(垂直移动方向)</td>
      </tr>
      <tr>
        <td>max_x_move</td>
        <td><span data-keyref="Type_Real"><a target="_blank" href="../../../../../GameMaker_Language/GML_Overview/Data_Types.htm">Real</a></span></td>
        <td><span data-conref="../../../../assets/snippets/Tag_optional.hts"><span class="optional">可选</span></span>&nbsp;实例应在 X 轴上移动的最大速度指定，-1 表示没有限制(这是默认行为)</td>
      </tr>
      <tr>
        <td>max_y_move</td>
        <td><span data-keyref="Type_Real"><a target="_blank" href="../../../../../GameMaker_Language/GML_Overview/Data_Types.htm">Real</a></span></td>
        <td><span data-conref="../../../../assets/snippets/Tag_optional.hts"><span class="optional">可选</span></span>&nbsp;实例应在 Y 轴上移动的最大速度指定，-1 表示没有限制(这是默认行为)</td>
      </tr>
    </tbody>
  </table>
  <p>&nbsp;</p>
  <h4>返回:</h4>
  <p class="code"><span data-keyref="Type_Array"><a target="_blank" href="../../../../../GameMaker_Language/GML_Overview/Arrays.htm">Array</a></span>&nbsp;of&nbsp;<span data-keyref="Type_ID_Instance"><a target="_blank" href="../../../../../GameMaker_Language/GML_Reference/Asset_Management/Instances/Instance_Variables/id.htm">Object Instance</a></span>s</p>
  <p>&nbsp;</p>
  <h4>例1：基本运动</h4>
  <p class="code"><span data-field="title" data-format="default">move_and_collide</span>(8, 0, all);</p>
  <p>上述代码将尝试把调用的实例移到右边8个像素处，并避开任何对象的实例(用&nbsp;<span class="inline2">all</span>&nbsp;关键字表示)。由于没有提供<span class="inline2">num_iterations</span>参数，迭代次数为4。</p>
  <p>&nbsp;</p>
  <h4>例2：显示与之碰撞的实例</h4>
  <p class="code">var _colliding_instances =&nbsp;<span data-field="title" data-format="default">move_and_collide</span>(speed_x, speed_y, obj_terrain);<br>
    <br>
    for (var i = 0; i &lt; array_length(_colliding_instances); i++)<br>
    {<br>
    &nbsp; &nbsp; var _collider = _colliding_instances[i];<br>
    &nbsp; &nbsp; with (_collider)<br>
    &nbsp; &nbsp; {<br>
    &nbsp; &nbsp; &nbsp; &nbsp; show_debug_message("Collision with instance {0}", id);<br>
    &nbsp; &nbsp; }<br>
    }
  </p>
  <p>上述代码在调用实例中执行了<span class="inline3_func"><span data-field="title" data-format="default">move_and_collide</span></span>&nbsp;函数。它试图使用自定义的<span class="inline2">speed_x</span>和<span class="inline2">speed_y</span>变量来移动它，并试图避免<span class="inline2">obj_terrain</span>的实例。调用实例所碰撞的实例被存储在一个临时数组<span class="inline2">_colliding_instances</span>&nbsp;并通过for循环和<span class="inline3_func"><a href="../../Debugging/show_debug_message.htm">show_debug_message</a></span>来显示。</p>
  <p>&nbsp;</p>
  <h4>Example 3: Tile Map</h4>
  <p class="code">var _tilemap = layer_tilemap_get_id("Tiles_1");<br>
    <br>
    <span data-field="title" data-format="default">move_and_collide</span>(8, 0, _tilemap);
  </p>
  <p>上面的代码将尝试将调用实例向右移动 8 个像素，并避免与 "Tiles_1" 层中的图块发生碰撞。</p>
  <p>由于您只需要获取一次图块地图 ID，因此您可以将第一行移至 Create 事件。</p>
  <p>&nbsp;</p>
  <p>&nbsp;</p>
  <div class="footer">
    <div class="buttons">
      <div class="clear">
        <div>Back:&nbsp;<a href="Movement.htm">运动</a></div>
        <div>Next:&nbsp;<a href="motion_add.htm">motion_add</a></div>
      </div>
    </div>
    <h5><span data-keyref="Copyright Notice">© Copyright YoYo Games Ltd. 2023 All Rights Reserved</span></h5>
  </div>
  <!-- KEYWORDS
move_and_collide
-->
  <!-- TAGS
move_and_collide
-->

</body></html>