<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript" language="JavaScript">function reDo(){innerWidth==origWidth&&innerHeight==origHeight||location.reload()}4==parseInt(navigator.appVersion)&&"Netscape"==navigator.appName&&(origWidth=innerWidth,origHeight=innerHeight,onresize=reDo),onerror=null</script><style type="text/css">p.WebHelpNavBar{text-align:right}</style><script type="text/javascript">gCommonRootRelPath=gRootRelPath="..",gTopicId="5.1_3"</script><script type="text/javascript" src="../template/scripts/rh.min.js"></script><script type="text/javascript" src="../template/scripts/common.min.js"></script><script type="text/javascript" src="../template/scripts/topic.min.js"></script><script type="text/javascript" src="../template/scripts/topicwidgets.min.js"></script><script type="text/javascript" src="../whxdata/projectsettings.js"></script><link rel="stylesheet" type="text/css" href="../template/styles/topic.min.css"><link rel="stylesheet" type="text/css" href="../template/Charcoal_Grey/topicheader.css"><meta name="topic-status" content="Draft"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>The File System</title><meta name="generator" content="Adobe RoboHelp 2022"><link rel="stylesheet" href="../assets/css/default.css" type="text/css"><script src="../assets/scripts/main_script.js" type="module"></script><meta name="rh-authors" content="Mark Alexander"><meta name="topic-comment" content="Page that explains how the GMS file system works for compiled games"><meta name="rh-index-keywords" content="The File System"><meta name="search-keywords" content="File System,sandbox,sandboxing,working directory,local storage"><meta name="brsnext" value="Settings/Audio_Groups.htm"><meta name="brsprev" value="Settings/Included_Files.htm"></head><body><div class="topic-header rh-hide" id="rh-topic-header"><div class="logo"></div><div class="nav"><div class="title" title="The File System"><span>The File System</span></div><div class="gotohome" title="Click here to see this page in full context"><a href="#" onclick="rh._.goToFullLayout()">Click here to see this page in full context</a></div></div></div><div class="topic-header-shadow rh-hide" id="rh-topic-header-shadow"></div><h1><span data-field="title" data-format="default">文件系统</span></h1><p>在<span data-keyref="GameMaker Name">GameMaker</span>中使用<a href="../GameMaker_Language/GML_Reference/File_Handling/File_Handling.htm">文件系统函数</a>或<a href="../Settings/Included_Files.htm">包含的文件</a>时，了解文件系统如何工作以及幕后发生了什么是很重要的。本节旨在解释和澄清<em>如何</em>存储内容，存储位置<em>以及</em>该系统可能存在的限制或解决方案。</p><p>关于文件功能，首先要注意的是，它们通常和默认情况下仅限于<strong>沙箱</strong>。这意味着，如果没有用户的<strong>显式</strong>输入，<span data-keyref="GameMaker Name">GameMaker</span><em>无法</em>从不是游戏包或设备本地存储的任何地方保存或加载文件，即使这样，这种输入也仅限于Windows，macOS和Ubuntu(Linux)目标平台。</p><div data-conref="../assets/snippets/Note_Important_File_System_Disable_Sandboxing.hts"><p class="note"><span data-conref="../assets/snippets/Tag_important.hts"><span class="important">重要信息</span></span>可以关闭桌面目标上的沙箱(Windows、macOS和Ubuntu)，方法是在目标平台的<strong>游戏选项</strong>中选中<a href="../Settings/Game_Options.htm">禁用文件系统沙箱</a>选项。您需要自担风险，虽然这将打开文件保存和加载，并允许您访问给定系统上的任何位置的文件，它可能仍然受到OS许可的限制。</p></div><h2>文件区域</h2><p>要理解沙盒，首先需要了解文件有两个不同的区域:</p><ul class="colour"><li><strong>捆绑文件</strong> - 这是存储与可执行文件打包在一起的所有文件的位置，包括您从 <strong>GameMaker</strong>IDE 添加到 <span data-keyref="GameMaker Name">包含文件</span> 资源列表的文件 (这些文件是您希望与游戏打包在一起的外部文件)。可以通过 <span class="inline2"><a href="../GameMaker_Language/GML_Reference/File_Handling/File_Directories/working_directory.htm">working_directory</a></span> 变量访问此区域，但是，文件将在阅读时自动从该位置读取，而不需要明确的路径-这将在下一节中详细解释。</li><li><strong>保存区域</strong> - 这是一个设备存储区域，游戏可以安全地写入该区域，并且游戏可以保证该区域是可写区域。可以通过 <span class="inline2"><a href="../GameMaker_Language/GML_Reference/General_Game_Control/game_save_id.htm">game_save_id</a></span> 变量访问该区域，但是文件在阅读时也会自动从该位置读取，并且默认情况下，任何保存都在此处完成。</li></ul><p>下面的图表可以帮助你更好地理解这一点:</p><p><img alt="File System Save Areas" class="center" src="../assets/Images/Scripting_Reference/Additional_Information/Files_SaveAreas.png"></p><h2 id="h1">访问文件区域</h2><p>当您的游戏被沙盒化时，每个目标平台上只有两个目标区域-<strong>捆绑文件</strong>和<strong>保存区域</strong>，但它们在每个平台上的工作方式略有不同。但是，<span data-keyref="GameMaker Name">GameMaker</span>已经抽象出了什么可以做，什么不可以做的主要本质，使您可以更轻松地将游戏重新定位到多个环境。</p><p>首先，让我们看看如何在<span data-keyref="GameMaker Name">GameMaker</span>中查找文件，假设您执行读取：</p><p class="code">buf = buffer_load("my_file.dat");</p><p>or a write:</p><p class="code">buffer_save(buf, "my_file.dat");</p><p>这将根据您是在阅读还是在写作来完成以下两件事之一：</p><ul class="colour"><li><strong>读取操作</strong>-此操作将首先检查<a href="../GameMaker_Language/GML_Reference/General_Game_Control/game_save_id.htm">保存区域</a>，以查看正在访问的文件是否存在，如果存在，则使用该区域。但是，如果文件在保存区域中不存在，则检查<a href="../GameMaker_Language/GML_Reference/File_Handling/File_Directories/working_directory.htm">捆绑文件区域</a>并使用该区域(如果正在查找的文件是游戏的<a href="../Settings/Included_Files.htm">包含文件</a>)。</li><li><strong>写入操作</strong>-这只能发生在保存区域中，除非禁用了沙箱并且明确指定了保存区域之外的路径。</li></ul><p>使用这两个简单的规则，我们现在可以看到以下函数是如何工作的（这些示例可帮助您可视化不同可用函数的过程）：</p><ul class="colour"><li><span class="inline3_func"><a href="../GameMaker_Language/GML_Reference/File_Handling/File_Directories/directory_create.htm">directory_create</a></span>(以及其他目录函数)仅在<strong>保存</strong>区域中起作用。</li><li><a href="../GameMaker_Language/GML_Reference/File_Handling/File_System/File_System.htm">文件系统函数</a>将返回有关来自<em></em><strong>捆绑</strong>和<strong>保存</strong>区域的文件的信息，但只会<em>写入</em><strong>保存</strong>区域。</li><li>如果不存在文本、二进制或INI文件，写入函数将在保存区创建一个新文件，如果存在，则复制游戏包中包含的原始文件中的任何信息。请注意，原始文件仍将保留在保存目录的只读部分，但只要保存区的读/写部分存在版本，它们就不会被引用。</li></ul><h2>在沙箱外</h2><p>在<strong>Windows</strong>、<strong>macOS</strong>和<strong>Ubuntu</strong>(Linux)平台上，有两种方法可以从沙箱外部保存和加载文件，即使用函数<span class="inline3_func"><a href="../GameMaker_Language/GML_Reference/File_Handling/File_System/get_open_filename.htm">get_open_filename</a></span>和<span class="inline3_func"><a href="../GameMaker_Language/GML_Reference/File_Handling/File_System/get_save_filename.htm">get_save_filename</a></span>(这两种功能都需要用户选择用于加载和保存的区域，然后返回的字符串可以在其余的文件函数中使用，以绕过沙箱-更多细节请参见函数描述)另一种方法是从目标平台的<a href="../Settings/Game_Options.htm">游戏选项</a>中完全禁用沙箱(仅适用于桌面目标，如本页后面所述)。</p><p>在 <strong>HTML5</strong> 上，也可以从服务器从沙箱外部加载文件，但是这应该只能使用函数 <span class="inline3_func"><a href="../GameMaker_Language/GML_Reference/Buffers/buffer_load_async.htm">buffer_load_async</a></span> 来完成，因为同步加载在大多数浏览器上已经被弃用，并且最终将被淘汰。这意味着以这种方式加载的文件应该保存为二进制文件-例如，你可以保存一个 <span class="inline">*.ini</span> 作为一个字符串 (详见 <span class="inline3_func"><a href="../GameMaker_Language/GML_Reference/File_Handling/Ini_Files/ini_close.htm">ini_close</a></span>)，然后将其写入一个缓冲区，然后可以使用 sprite_add 函数保存和加载。注意，如果你使用 <span class="inline3_func"><a href="../GameMaker_Language/GML_Reference/Asset_Management/Sprites/Sprite_Manipulation/sprite_add.htm">sprite_add</a></span> 加载图像，那么这些已经被异步处理了。</p><h2 id="h">保存区域位置</h2><p>每个目标平台都有自己的保存区域，可以在其中写入和读取文件和目录。下面是每个目标在沙箱化时的这些区域的列表：</p><ul class="colour"><li><strong>Windows</strong>：Windows的所有文件都在<span class="inline">%localappdata%/&lt;Game Name&gt;</span></li><li><strong>HTML5</strong>，<strong>GX.games</strong>：一切都通过本地存储完成。</li><li><strong>macOS</strong>: 存储将取决于应用程序是否被沙盒化(遵循苹果的规则，路径通常是<span class="inline">~/Library/application Support/&lt;游戏名称&gt;</span>)。</li><li><strong>Ubuntu (Linux)</strong>: 文件存储在 <span class="inline">Home/.config/gamename</span> 其中“Home”是用户的主目录 -<span class="inline">/Home/&lt;用户名&gt;</span></li><li><strong>iOS</strong> / <strong>tvOS</strong>: 存储是标准的位置(通过iTunes查看)。</li><li><strong>Android</strong>: 文件位于标准位置 <span class="inline">/data/&lt;包名&gt;</span> (除非设备处于root，否则不可见)。</li></ul><p>值得注意的是，HTML5目标模块对本地存储有限制(根据浏览器的不同，可能在1MB到5MB之间)，这意味着您将不被允许保存大型精灵，屏幕截图等。</p><p>&nbsp;</p><p>&nbsp;</p><div class="footer"><div class="buttons"><div class="clear"><div style="float:left">Back:&nbsp;<a href="../Settings/Game_Settings.htm">GameMaker Runner</a></div><div style="float:right">Next:&nbsp;<a href="../Settings/Audio_Groups.htm">音频组</a></div></div></div><h5><span data-keyref="Copyright Notice">© Copyright YoYo Games Ltd. 2024 All Rights Reserved</span></h5></div></body></html>