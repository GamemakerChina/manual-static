<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript" language="JavaScript">function reDo(){innerWidth==origWidth&&innerHeight==origHeight||location.reload()}4==parseInt(navigator.appVersion)&&"Netscape"==navigator.appName&&(origWidth=innerWidth,origHeight=innerHeight,onresize=reDo),onerror=null</script><style type="text/css">p.WebHelpNavBar{text-align:right}</style><script type="text/javascript">gCommonRootRelPath=gRootRelPath="../../../../..",gTopicId="8.2.2.3.14.2.0_11"</script><script type="text/javascript" src="../../../../../template/scripts/rh.min.js"></script><script type="text/javascript" src="../../../../../template/scripts/common.min.js"></script><script type="text/javascript" src="../../../../../template/scripts/topic.min.js"></script><script type="text/javascript" src="../../../../../template/scripts/topicwidgets.min.js"></script><script type="text/javascript" src="../../../../../whxdata/projectsettings.js"></script><link rel="stylesheet" type="text/css" href="../../../../../template/styles/topic.min.css"><link rel="stylesheet" type="text/css" href="../../../../../template/Charcoal_Grey/topicheader.css"><meta name="topic-status" content="Draft"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>tilemap_set_mask</title><meta name="generator" content="Adobe RoboHelp 2022"><link rel="stylesheet" href="../../../../../assets/css/default.css" type="text/css"><script src="../../../../../assets/scripts/main_script.js" type="module"></script><meta name="rh-authors" content="Mark Alexander"><meta name="topic-comment" content="Page outlining the function tilemap_set_mask"><meta name="rh-index-keywords" content="tilemap_set_mask,tile_rotate,tile_mirror,tile_flip,tile_index_mask"><meta name="search-keywords" content="tilemap_set_mask,tile_rotate,tile_mirror,tile_flip,tile_index_mask"><meta name="brsnext" value="GameMaker_Language/GML_Reference/Asset_Management/Rooms/Tile_Map_Layers/tilemap_set_global_mask.htm"><meta name="brsprev" value="GameMaker_Language/GML_Reference/Asset_Management/Rooms/Tile_Map_Layers/tilemap_set_at_pixel.htm"></head><body><div class="topic-header rh-hide" id="rh-topic-header"><div class="logo"></div><div class="nav"><div class="title" title="tilemap_set_mask"><span>tilemap_set_mask</span></div><div class="gotohome" title="Click here to see this page in full context"><a href="#" onclick="rh._.goToFullLayout()">Click here to see this page in full context</a></div></div></div><div class="topic-header-shadow rh-hide" id="rh-topic-header-shadow"></div><h1><span data-field="title" data-format="default">tilemap_set_mask</span></h1><p>此函数为单个图块地图设置 <a data-rhwidget="HyperlinkPopover" href="Tile_Map_Layers.htm#tile_map_bit_mask">图块地图位掩码</a> 。</p><p>您提供图块地图元素 ID(在使用 <span class="inline3_func"><a href="layer_tilemap_create.htm">layer_tilemap_create</a></span> 创建图块地图元素或使用函数 <span class="inline3_func"><a href="layer_tilemap_get_id.htm">layer_tilemap_get_id</a></span> 时获得)，然后提供掩码值。例如，如果您有一个非常小的 16 x 16 个图块集，那么您的图块集中总共有 256 个不同的图块。您只需要<a data-rhwidget="HyperlinkPopover" href="Tile_Map_Layers.htm#h3"></a> 的 8 位即可为这些图块建立索引 (来自可用的 <span data-keyref="Const_Tile_Data_Max_Index_Bits">19</span> 位数据)。这些位可以被 " 屏蔽"，然后瓦片数据的其余部分可以用于存储附加值。请参阅 <a href="Tile_Map_Layers.htm#calculating_the_mask_bits">计算掩码位</a> 。</p><p>图块地图位掩码是一项高级功能，允许您将图块数据 "blob" 的位供您自己使用。例如，您可以在图块数据中保留一些表示 " 实体 " 的位，然后可以检查快速碰撞。基本上，当 <i>绘制</i> 图块地图时，位掩码会针对图块数据进行 " 与 " 运算 (因此不会影响任何其他功能)，这意味着不在掩码中的位被忽略，但用户仍可以出于自己的目的进行读取和写入。</p><p>&nbsp;</p><h4>语法:</h4><p class="code"><span data-field="title" data-format="default">tilemap_set_mask</span>(tilemap_element_id, mask);</p><table><tbody><tr><th>参数</th><th>类型</th><th>描述</th></tr><tr><td>tilemap_element_id</td><td><span data-keyref="Type_ID_Element_Tilemap"><a target="_blank" href="layer_tilemap_get_id.htm">Tile Map Element ID</a></span></td><td>要设置掩码的图块贴图元素的唯一ID值</td></tr><tr><td>mask</td><td><span data-keyref="Type_Real"><a target="_blank" href="../../../../GML_Overview/Data_Types.htm">Real</a></span></td><td>掩码值</td></tr></tbody></table><p>&nbsp;</p><h4>返回:</h4><p class="code"><span data-keyref="Type_Void">N/A</span></p><p>&nbsp;</p><h4>Example 1: Using 8 bits for the tile index</h4><p class="code">var _lay_id = layer_get_id("Tiles_sky");<br>var _map_id = layer_tilemap_get_id(_lay_id);<br>var _mask = tile_mirror | tile_flip | tile_rotate | 255;<br>tilemap_set_mask(_map_id, _mask);</p><p>上述代码从给定图层获取图块地图 ID，然后将图块地图位掩码设置为 8 位 (值为 <span class="inline2">255</span> 或 <span class="inline2">0b11111111</span>)，保留每个图块的翻转、镜像和旋转值平铺在地图上。</p><p>&nbsp;</p><h4>Example 2: Resetting to the default mask</h4><p class="code">var _lay_id = layer_get_id("Tiles_sky");<br>var _map_id = layer_tilemap_get_id(_lay_id);<br>var _mask = tile_mirror | tile_flip | tile_rotate | tile_index_mask;<br>tilemap_set_mask(_map_id, _mask);</p><p>上面的代码通过使用按位或组合所有图块掩码常量，将图块位掩码设置为 <span data-keyref="GameMaker Name">GameMaker</span> 正确绘制图块所需的值。完整的 <span data-keyref="Const_Tile_Data_Max_Index_Bits">19</span> 位用于图块索引，并保留镜像、翻转和旋转位。</p><p>&nbsp;</p><h4>Example 3: Writing and reading back custom data</h4><p class="code_heading">Create Event</p><p class="code">randomise();<br><br>var _lay_id = layer_get_id("Tiles_1");<br>var _map_id = layer_tilemap_get_id(_lay_id);<br>var _mask = tile_mirror | tile_flip | tile_rotate | 255;<br>tilemap_set_mask(_map_id, _mask);<br>for(var _x = 0;_x &lt; tilemap_get_width(_map_id);_x++)<br>{<br>&nbsp; &nbsp; for(var _y = 0;_y &lt; tilemap_get_height(_map_id);_y++)<br>&nbsp; &nbsp; {<br>&nbsp; &nbsp; &nbsp; &nbsp; var _tdata = tilemap_get(_map_id, _x, _y);<br>&nbsp; &nbsp; &nbsp; &nbsp; var _random_value = irandom(255);<br>&nbsp; &nbsp; &nbsp; &nbsp; var _random_value_shifted = _random_value &lt;&lt; 8;<br>&nbsp; &nbsp; &nbsp; &nbsp; _tdata |= _random_value_shifted;<br>&nbsp; &nbsp; &nbsp; &nbsp; tilemap_set(_map_id, _tdata, _x, _y);<br>&nbsp; &nbsp; }<br>}</p><p class="code_heading">Step Event</p><p class="code">var _tdata = tilemap_get_at_pixel(map_id, mouse_x, mouse_y);<br>random_value_under_cursor = (_tdata &gt;&gt; 8) &amp; 255;</p><p class="code_heading">Draw GUI Event</p><p class="code">draw_text(5, 5, $"Value: {random_value_under_cursor}");</p><p>上面的代码显示了如何在图块地图的单元格中存储一些自定义数据并读取它们。</p><p>在创建事件中，位掩码设置为 8 个最低位加上镜像、翻转和旋转位。然后将 0 到 255 之间的随机整数值写入每个图块的位 8 到 15。具体操作如下：<span class="inline2">_random_value</span> 的位首先 <em>左</em> 移位 8 位，例如，值 <span class="inline2">0b0000000011001111</span>(<span class="inline2">207</span>) 变为 <span class="inline2">0b1111111100000000</span>(<span class="inline2">52992</span>)。此结果存储在 <span class="inline2">_random_value_shifted</span> 中。然后，该值与图块数据进行按位 " 或 " 运算 <span class="inline2">|</span>，只要在图块数据或随机值中设置了一位，就会得到 1 位。然后，使用 <span class="inline3_func"><a href="tilemap_set.htm">tilemap_set</a></span> 将图块数据写回同一图块地图调用。</p><p>在 Step 事件中，使用 <span class="inline3_func"><a href="tilemap_get_at_pixel.htm">tilemap_get_at_pixel</a></span> 查找鼠标下方的图块数据。为了取回随机值，首先将这些位 <em>右移</em> 8 位，这会将随机值的 8 位移回位位置 0 到 7( 索引位也会右移，因此会丢失) 在此刻)。然后，这个新值按位 " 与 "-ed<span class="inline2">&amp;</span> 为 255，以仅保留保存随机值的低 8 位 (可以设置任何镜像、翻转或旋转位，无需 " 与" -ing 会给出更高的值)。结果分配给 <span class="inline2">random_value_under_cursor</span>。</p><p>鼠标位置下的图块中存储的随机值显示在 Draw GUI 事件中。</p><p>&nbsp;</p><p>&nbsp;</p><div class="footer"><div class="buttons"><div class="clear"><div style="float:left">Back:&nbsp;<a href="Tile_Map_Layers.htm">平铺地图元素</a></div><div style="float:right">Next:&nbsp;<a href="tilemap_set_global_mask.htm">tilemap_set_global_mask</a></div></div></div><h5><span data-keyref="Copyright Notice">© Copyright YoYo Games Ltd. 2024 All Rights Reserved</span></h5></div></body></html>